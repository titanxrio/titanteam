<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Titan Leaks</title>
  <!-- Verknüpfung mit style.css -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <!-- NAVIGATION OBEN MIT DISCORD-BUTTON -->
  <nav>
    <div class="nav-title">Titan Leaks</div>
    <!-- Discord-Link anpassen -->
    <a class="discord-btn" href="https://discord.gg/DEIN-EINLADUNGS-LINK" target="_blank">Join Discord</a>
  </nav>

  <!-- HAUPT-HEADER -->
  <header>
    <h1>LEAKS & FILES</h1>
    <p>Die neuesten Dateien findest du hier:</p>
  </header>

  <!-- DYNAMISCHE DATEILISTE -->
  <ul id="fileList"></ul>

  <script>
    const repo = "titanxrio/titanteam"; // Dein GitHub-Repository
    const branch = "main";             // Branch-Name
    const folder = "";                 // Ordner (leer lassen für root)

    // Dateien beim Laden der Seite abrufen
    document.addEventListener("DOMContentLoaded", fetchFiles);

    async function fetchFiles() {
      try {
        const response = await fetch(
          `https://api.github.com/repos/${repo}/contents/${folder}?ref=${branch}`
        );
        const files = await response.json();
        const fileList = document.getElementById("fileList");
        fileList.innerHTML = "";

        for (const file of files) {
          // Ignoriere index.html & style.css
          if (
            file.type === "file" &&
            file.name !== "index.html" &&
            file.name !== "style.css"
          ) {
            const li = document.createElement("li");

            // Letztes Commit-Datum abrufen
            const commitDate = await fetchFileDate(file.path);
            const displayDate = commitDate
              ? new Date(commitDate).toLocaleString()
              : "unbekannt";

            li.innerHTML = `
              <div class="upload-date">Hochgeladen: ${displayDate}</div>
              <a class="download-btn" href="${file.download_url}" download>
                ${file.name}
              </a>
            `;
            fileList.appendChild(li);
          }
        }
      } catch (error) {
        console.error("Fehler beim Laden der Dateien:", error);
      }
    }

    // Letztes Commit-Datum für die jeweilige Datei holen
    async function fetchFileDate(path) {
      try {
        const commitsUrl = `https://api.github.com/repos/${repo}/commits?path=${encodeURIComponent(path)}&sha=${branch}&per_page=1`;
        const response = await fetch(commitsUrl);
        const commitData = await response.json();
        if (commitData && commitData.length > 0) {
          return commitData[0].commit.author.date;
        }
      } catch (err) {
        console.error("Fehler beim Laden des Commit-Datums:", err);
      }
      return null;
    }
  </script>
</body>
</html>
